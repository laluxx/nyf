[{"contents":["std.os.thread",null],"tag":"UseDecl"},{"contents":["std.core.test",null],"tag":"UseDecl"},{"contents":{"contents":[{"contents":"print","tag":"Var"},[{"argName":null,"argValue":{"contents":"Testing Threads...","tag":"StrLit"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":[["counter_ptr"],{"contents":[{"contents":"rt_malloc","tag":"Var"},[{"argName":null,"argValue":{"contents":8,"tag":"IntLit"}}]],"tag":"Call"}],"tag":"DefineDecl"},{"contents":{"contents":[{"contents":"store64","tag":"Var"},[{"argName":null,"argValue":{"contents":"counter_ptr","tag":"Var"}},{"argName":null,"argValue":{"contents":0,"tag":"IntLit"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":[["mtx"],{"contents":[{"contents":"mutex_new","tag":"Var"},[]],"tag":"Call"}],"tag":"DefineDecl"},{"contents":[["ptr_val"],{"contents":[{"contents":"load64","tag":"Var"},[{"argName":null,"argValue":{"contents":"counter_ptr","tag":"Var"}}]],"tag":"Call"}],"tag":"DefineDecl"},{"contents":{"contents":[{"contents":"assert","tag":"Var"},[{"argName":null,"argValue":{"contents":["Eq",{"contents":"ptr_val","tag":"Var"},{"contents":0,"tag":"IntLit"}],"tag":"BinOp"}},{"argName":null,"argValue":{"contents":"init counter","tag":"StrLit"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":["worker",[{"paramDefault":null,"paramName":"args","paramType":null}],null,null,[{"contents":[["m"],{"contents":[{"contents":"load64","tag":"Var"},[{"argName":null,"argValue":{"contents":"args","tag":"Var"}}]],"tag":"Call"}],"tag":"VarDecl"},{"contents":{"contents":"use","tag":"Var"},"tag":"ExprStmt"},{"contents":[["m"],{"contents":[{"contents":"get","tag":"Var"},[{"argName":null,"argValue":{"contents":"args","tag":"Var"}},{"argName":null,"argValue":{"contents":0,"tag":"IntLit"}}]],"tag":"Call"}],"tag":"VarDecl"},{"contents":[["c"],{"contents":[{"contents":"get","tag":"Var"},[{"argName":null,"argValue":{"contents":"args","tag":"Var"}},{"argName":null,"argValue":{"contents":1,"tag":"IntLit"}}]],"tag":"Call"}],"tag":"VarDecl"},{"contents":{"contents":[{"contents":"mutex_lock","tag":"Var"},[{"argName":null,"argValue":{"contents":"m","tag":"Var"}}]],"tag":"Call"},"tag":"ExprStmt"},{"contents":[["v"],{"contents":[{"contents":"load64","tag":"Var"},[{"argName":null,"argValue":{"contents":"c","tag":"Var"}}]],"tag":"Call"}],"tag":"VarDecl"},{"contents":{"contents":[{"contents":"store64","tag":"Var"},[{"argName":null,"argValue":{"contents":"c","tag":"Var"}},{"argName":null,"argValue":{"contents":["Add",{"contents":"v","tag":"Var"},{"contents":1,"tag":"IntLit"}],"tag":"BinOp"}}]],"tag":"Call"},"tag":"ExprStmt"},{"contents":{"contents":[{"contents":"mutex_unlock","tag":"Var"},[{"argName":null,"argValue":{"contents":"m","tag":"Var"}}]],"tag":"Call"},"tag":"ExprStmt"},{"contents":{"contents":0,"tag":"IntLit"},"tag":"ReturnStmt"}]],"tag":"FnDecl"},{"contents":[["args"],{"contents":[{"contents":"list","tag":"Var"},[]],"tag":"Call"}],"tag":"DefineDecl"},{"contents":{"contents":"stmt","tag":"Var"},"tag":"ExprDecl"},{"contents":{"contents":"stmt","tag":"Var"},"tag":"ExprDecl"},{"contents":[["t1"],{"contents":[{"contents":"thread_spawn","tag":"Var"},[{"argName":null,"argValue":{"contents":"worker","tag":"Var"}},{"argName":null,"argValue":{"contents":"args","tag":"Var"}}]],"tag":"Call"}],"tag":"DefineDecl"},{"contents":[["t2"],{"contents":[{"contents":"thread_spawn","tag":"Var"},[{"argName":null,"argValue":{"contents":"worker","tag":"Var"}},{"argName":null,"argValue":{"contents":"args","tag":"Var"}}]],"tag":"Call"}],"tag":"DefineDecl"},{"contents":[["t3"],{"contents":[{"contents":"thread_spawn","tag":"Var"},[{"argName":null,"argValue":{"contents":"worker","tag":"Var"}},{"argName":null,"argValue":{"contents":"args","tag":"Var"}}]],"tag":"Call"}],"tag":"DefineDecl"},{"contents":{"contents":[{"contents":"thread_join","tag":"Var"},[{"argName":null,"argValue":{"contents":"t1","tag":"Var"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":{"contents":[{"contents":"thread_join","tag":"Var"},[{"argName":null,"argValue":{"contents":"t2","tag":"Var"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":{"contents":[{"contents":"thread_join","tag":"Var"},[{"argName":null,"argValue":{"contents":"t3","tag":"Var"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":[["final"],{"contents":[{"contents":"load64","tag":"Var"},[{"argName":null,"argValue":{"contents":"counter_ptr","tag":"Var"}}]],"tag":"Call"}],"tag":"DefineDecl"},{"contents":{"contents":[{"contents":"print","tag":"Var"},[{"argName":null,"argValue":{"contents":"Final counter:","tag":"StrLit"}},{"argName":null,"argValue":{"contents":"final","tag":"Var"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":{"contents":[{"contents":"assert","tag":"Var"},[{"argName":null,"argValue":{"contents":["Eq",{"contents":"final","tag":"Var"},{"contents":3,"tag":"IntLit"}],"tag":"BinOp"}},{"argName":null,"argValue":{"contents":"thread mutex counter","tag":"StrLit"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":{"contents":[{"contents":"mutex_free","tag":"Var"},[{"argName":null,"argValue":{"contents":"mtx","tag":"Var"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":{"contents":[{"contents":"rt_free","tag":"Var"},[{"argName":null,"argValue":{"contents":"counter_ptr","tag":"Var"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":{"contents":[{"contents":"print","tag":"Var"},[{"argName":null,"argValue":{"contents":"âœ“ std.os.thread passed","tag":"StrLit"}}]],"tag":"Call"},"tag":"ExprDecl"}]