[{"contents":["std.net.socket",null],"tag":"UseDecl"},{"contents":["std.strings.str",null],"tag":"UseDecl"},{"contents":["std.os.thread",null],"tag":"UseDecl"},{"contents":["std.core.test",null],"tag":"UseDecl"},{"contents":[["PORT"],{"contents":50002,"tag":"IntLit"}],"tag":"DefineDecl"},{"contents":{"contents":[{"contents":"print","tag":"Var"},[{"argName":null,"argValue":{"contents":"Testing Sockets... SKIPPED (hangs)","tag":"StrLit"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":{"contents":[{"contents":"exit","tag":"Var"},[{"argName":null,"argValue":{"contents":0,"tag":"IntLit"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":["server_task",[{"paramDefault":null,"paramName":"arg","paramType":null}],null,null,[{"contents":[["port"],{"contents":"arg","tag":"Var"}],"tag":"VarDecl"},{"contents":[["s"],{"contents":[{"contents":"socket_bind","tag":"Var"},[{"argName":null,"argValue":{"contents":"127.0.0.1","tag":"StrLit"}},{"argName":null,"argValue":{"contents":"port","tag":"Var"}}]],"tag":"Call"}],"tag":"VarDecl"},{"contents":[{"contents":["Lt",{"contents":"s","tag":"Var"},{"contents":0,"tag":"IntLit"}],"tag":"BinOp"},[{"contents":{"contents":[{"contents":"panic","tag":"Var"},[{"argName":null,"argValue":{"contents":"server bind failed","tag":"StrLit"}}]],"tag":"Call"},"tag":"ExprStmt"}],null],"tag":"IfStmt"},{"contents":[["c"],{"contents":[{"contents":"socket_accept","tag":"Var"},[{"argName":null,"argValue":{"contents":"s","tag":"Var"}}]],"tag":"Call"}],"tag":"VarDecl"},{"contents":[{"contents":["Lt",{"contents":"c","tag":"Var"},{"contents":0,"tag":"IntLit"}],"tag":"BinOp"},[{"contents":{"contents":[{"contents":"panic","tag":"Var"},[{"argName":null,"argValue":{"contents":"server accept failed","tag":"StrLit"}}]],"tag":"Call"},"tag":"ExprStmt"}],null],"tag":"IfStmt"},{"contents":[["req"],{"contents":[{"contents":"read_socket","tag":"Var"},[{"argName":null,"argValue":{"contents":"c","tag":"Var"}},{"argName":null,"argValue":{"contents":1024,"tag":"IntLit"}}]],"tag":"Call"}],"tag":"VarDecl"},{"contents":[{"contents":[{"contents":"eq","tag":"Var"},[{"argName":null,"argValue":{"contents":"req","tag":"Var"}},{"argName":null,"argValue":{"contents":"ping","tag":"StrLit"}}]],"tag":"Call"},[{"contents":{"contents":[{"contents":"write_socket","tag":"Var"},[{"argName":null,"argValue":{"contents":"c","tag":"Var"}},{"argName":null,"argValue":{"contents":"pong","tag":"StrLit"}}]],"tag":"Call"},"tag":"ExprStmt"}],null],"tag":"IfStmt"},{"contents":{"contents":[{"contents":"close_socket","tag":"Var"},[{"argName":null,"argValue":{"contents":"c","tag":"Var"}}]],"tag":"Call"},"tag":"ExprStmt"},{"contents":{"contents":[{"contents":"close_socket","tag":"Var"},[{"argName":null,"argValue":{"contents":"s","tag":"Var"}}]],"tag":"Call"},"tag":"ExprStmt"},{"contents":{"contents":0,"tag":"IntLit"},"tag":"ReturnStmt"}]],"tag":"FnDecl"},{"contents":[["t"],{"contents":[{"contents":"thread_spawn","tag":"Var"},[{"argName":null,"argValue":{"contents":"server_task","tag":"Var"}},{"argName":null,"argValue":{"contents":"PORT","tag":"Var"}}]],"tag":"Call"}],"tag":"DefineDecl"},{"contents":{"contents":[{"contents":"sleep","tag":"Var"},[{"argName":null,"argValue":{"contents":1,"tag":"IntLit"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":[["c"],{"contents":[{"contents":"socket_connect","tag":"Var"},[{"argName":null,"argValue":{"contents":"127.0.0.1","tag":"StrLit"}},{"argName":null,"argValue":{"contents":"PORT","tag":"Var"}}]],"tag":"Call"}],"tag":"DefineDecl"},{"contents":{"contents":"stmt","tag":"Var"},"tag":"ExprDecl"},{"contents":{"contents":[{"contents":"write_socket","tag":"Var"},[{"argName":null,"argValue":{"contents":"c","tag":"Var"}},{"argName":null,"argValue":{"contents":"ping","tag":"StrLit"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":[["res"],{"contents":[{"contents":"read_socket","tag":"Var"},[{"argName":null,"argValue":{"contents":"c","tag":"Var"}},{"argName":null,"argValue":{"contents":1024,"tag":"IntLit"}}]],"tag":"Call"}],"tag":"DefineDecl"},{"contents":{"contents":[{"contents":"print","tag":"Var"},[{"argName":null,"argValue":{"contents":"Got:","tag":"StrLit"}},{"argName":null,"argValue":{"contents":"res","tag":"Var"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":{"contents":[{"contents":"assert","tag":"Var"},[{"argName":null,"argValue":{"contents":[{"contents":"eq","tag":"Var"},[{"argName":null,"argValue":{"contents":"res","tag":"Var"}},{"argName":null,"argValue":{"contents":"pong","tag":"StrLit"}}]],"tag":"Call"}},{"argName":null,"argValue":{"contents":"socket ping/pong","tag":"StrLit"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":{"contents":[{"contents":"close_socket","tag":"Var"},[{"argName":null,"argValue":{"contents":"c","tag":"Var"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":{"contents":[{"contents":"thread_join","tag":"Var"},[{"argName":null,"argValue":{"contents":"t","tag":"Var"}}]],"tag":"Call"},"tag":"ExprDecl"},{"contents":{"contents":[{"contents":"print","tag":"Var"},[{"argName":null,"argValue":{"contents":"âœ“ std.net.socket passed","tag":"StrLit"}}]],"tag":"Call"},"tag":"ExprDecl"}]